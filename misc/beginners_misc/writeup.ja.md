# Beginner's Misc Writeup Ja

## 問題

問題のコードは以下の通りである。

```python
exploit = input('? ')
if eval(b64encode(exploit.encode('UTF-8'))) == math.pi:
  print(open('flag.txt').read())
```

Base64でエンコードしてPythonでevalしたときに`math.pi`と一致するようなUTF-8文字列を考えろ、というのが問題の趣旨である。

## 解法

Base64では元文字列の3文字が4文字に変換される。よってBase64上で4文字ごとに区切って考えるのが自然であろう。

そこで、以下のようなBase64文字列を構成することを考える。

![](https://i.imgur.com/9zAUSpx.jpg)

これはPythonで受理可能な巨大な桁数の分数の形をしている。

UTF-8でvalidとなるような数字4文字のBase64文字列を探索し、これを用いて左の文字列から分数を決めていくことで上の桁から確定することができる。

最後の方は桁数を合わせないとBase64で怒られるので、0になりそうな適当な値を足してあげれば安全である。

この方法により例えば以下のようなexploit文字列を得る。

```
ｶ箷ןz㍶㍿ێ|ׯvӝ<׍uӍ>㍿㍴㍴㍴㍴㍴㍴㍴㍴㍴㍴
```

これをBase64エンコードすると、

```python
7722566315964422442/2458169205081411040+442/4420442044204420442044204420442044204420
```

となり、Pythonで評価すると

```python
>>> 7722566315964422442/2458169205081411040+442/4420442044204420442044204420442044204420
3.141592653589793
```

を得る。

ちなみにゴルフするとこれくらいになる。

```
㮼뎼מ;㍿׿9ێ|ӟ7׽>׍{
466864681547442/178524580583170+746/1417
```

ちなみに TSG CTF 開催期間中に送信された回答の中でもっとも短いものは21バイトだった。

## ソルバ

[solve.rb](solver/solve.rb)